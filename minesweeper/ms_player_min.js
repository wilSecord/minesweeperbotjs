var grid,unsolved_squares,width,height,GAME_COUNT;function displayGrid(){for(var e="",t=0;t<grid.length;t++){e+="\n";for(var r=0;r<grid[t].length;r++)e+=grid[t][r].state+" "}return e}function solveGames(e,t){GAME_COUNT=100,solve(e,t)}function solve(e,t){if(0!=GAME_COUNT){console.log(GAME_COUNT+" games left"),GAME_COUNT--,width=t,height=e,unsolved_squares=new Set,grid=[];for(var r=0;r<t;r++){for(var a=[],s=0;s<e;s++){var i=new Square(r,s);a.push(i),unsolved_squares.add(i)}grid.push(a)}for(clickSmile(),click(Math.floor(width/2),Math.floor(height/2));unsolved_squares.size>0;){if(gameOver())return solve(e,t);updateGrid(grid);var n=[],o=[];if(unsolved_squares.forEach(function(e){var t=e.state;if("number"==typeof t){if(0==t)return void unsolved_squares.delete(e);for(var r=getNeighbors(e),a=[],s=[],i=0;i<r.length;i++)"_"!=r[i].state||r[i].flagged?r[i].flagged&&s.push(r[i]):a.push(r[i]);if(0==a.length)unsolved_squares.delete(e);else if(s.length==t){for(i=0;i<a.length;i++)n.push(a[i]);unsolved_squares.delete(e)}else if(s.length+a.length==t){for(i=0;i<a.length;i++)o.push(a[i]);unsolved_squares.delete(e)}else if(s.length>t)return void console.log("there was a flagging error")}}),n.length+o.length==0)e:for(r=0;r<width;r++)for(s=0;s<height;s++)if("_"==grid[r][s].state&&!grid[r][s].flagged){n.push(grid[r][s]);break e}for(r=0;r<n.length;r++)click(n[r].x,n[r].y);for(r=0;r<o.length;r++)o[r].flag(),unsolved_squares.delete(o[r])}}}function gameOver(){return"facedead"==$("#face").attr("class")}function getNeighbors(e){for(var t=[],r=Math.max(0,e.x-1),a=Math.min(width-1,e.x+1),s=Math.max(0,e.y-1),i=Math.min(height-1,e.y+1),n=r;n<=a;n++)for(var o=s;o<=i;o++)n==e.x&&o==e.y||t.push(grid[n][o]);return t}function clickSmile(){var e=$("#face")[0];$(document).trigger({type:"mousedown",button:0,target:e}).trigger({type:"mouseup",button:0,target:e})}function click(e,t){var r=$("#"+(t+1)+"_"+(e+1))[0];$(document).trigger({type:"mousedown",button:0,target:r}).trigger({type:"mouseup",button:0,target:r})}function flag_click(e,t){var r=$("#"+(t+1)+"_"+(e+1))[0];$(document).trigger({type:"mousedown",button:2,target:r}).trigger({type:"mouseup",button:2,target:r})}function Square(e,t){this.x=e,this.y=t,this.state="_",this.flagged=!1,this.flag=function(){this.flagged=!0,this.state="f",flag_click(this.x,this.y)}}function updateGrid(e){for(var t=0;t<width;t++)for(var r=0;r<height;r++){var a=getValue(t,r);e[t][r].state=a}}function getValue(e,t){var r=$("#"+(t+1)+"_"+(e+1)).attr("class");return r.startsWith("square open")?parseInt(r[11]):"square bombflagged"==r?"f":"square blank"==r?"_":"X"}